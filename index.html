<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡å¤–å®šå‘ - è£å‚™æ”¶é›†ç‰ˆ</title>
    <style>
        :root {
            --bg-color: #c8e6c9;
            --road-color: #8d6e63;
            --ui-bg: rgba(255, 255, 255, 0.95);
            --primary: #2e7d32;
            --accent: #ff6f00;
        }

        body {
            font-family: "Microsoft JhengHei", sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            /* è‰åœ°ç´‹ç† */
            background-image: radial-gradient(#a5d6a7 15%, transparent 16%), radial-gradient(#a5d6a7 15%, transparent 16%);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
        }

        /* éŠæˆ²ä¸»å®¹å™¨ */
        #game-wrapper {
            width: 100%;
            max-width: 600px;
            height: 100vh;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        /* é ‚éƒ¨è³‡è¨Šæ¬„ */
        header {
            background: var(--ui-bg);
            padding: 10px 20px;
            border-radius: 0 0 20px 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            z-index: 10;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* èƒŒåŒ…å€åŸŸ */
        .inventory-box {
            display: flex;
            gap: 5px;
            background: #eee;
            padding: 5px 10px;
            border-radius: 15px;
            border: 2px solid #bdbdbd;
        }
        .inv-slot {
            width: 30px;
            height: 30px;
            background: #fff;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
            color: #ccc; /* æœªç²å¾—æ™‚ç°è‰² */
            border: 1px solid #ddd;
        }
        .inv-slot.earned {
            background: #fff8e1;
            border-color: #ffca28;
            animation: popIn 0.5s;
        }

        /* é“è·¯å ´æ™¯ */
        .road-scene {
            flex-grow: 1;
            position: relative;
            perspective: 800px;
            overflow: hidden;
            display: flex;
            justify-content: center;
        }

        /* é“è·¯ç¹ªè£½ */
        .road {
            position: absolute;
            bottom: 0;
            width: 100px;
            height: 100%;
            background: var(--road-color);
            transform-origin: bottom;
            transform: rotateX(60deg) scaleY(2);
            box-shadow: inset 0 0 20px rgba(0,0,0,0.3);
        }
        .road::before { /* å·¦å²”è·¯ */
            content: '';
            position: absolute;
            top: 0; left: -50px;
            width: 80px; height: 300px;
            background: var(--road-color);
            transform: rotate(-30deg);
            transform-origin: bottom right;
        }
        .road::after { /* å³å²”è·¯ */
            content: '';
            position: absolute;
            top: 0; right: -50px;
            width: 80px; height: 300px;
            background: var(--road-color);
            transform: rotate(30deg);
            transform-origin: bottom left;
        }

        /* ç©å®¶è§’è‰² */
        #player {
            position: absolute;
            bottom: 20px;
            font-size: 4rem;
            transition: all 0.5s;
            z-index: 5;
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.3));
        }

        /* èµ°è·¯å‹•ç•« Class */
        .walking-up {
            animation: walkUp 1.5s ease-out forwards;
        }
        
        @keyframes walkUp {
            0% { bottom: -100px; transform: scale(1.2) rotate(-5deg); }
            25% { transform: scale(1.1) rotate(5deg); }
            50% { transform: scale(1.0) rotate(-5deg); }
            75% { transform: scale(0.9) rotate(5deg); }
            100% { bottom: 180px; transform: scale(0.8) rotate(0deg); }
        }

        /* é¡Œç›®é¢æ¿ */
        .question-panel {
            position: absolute;
            top: 15%; 
            left: 5%; right: 5%;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            text-align: center;
            z-index: 20;
            display: none; /* åˆå§‹éš±è— */
            animation: slideDown 0.5s ease-out;
            border-top: 6px solid var(--accent);
        }

        .q-text { font-size: 1.1rem; margin-bottom: 20px; text-align: left; line-height: 1.6; }
        
        .btn-container {
            display: flex;
            gap: 15px;
        }
        
        .choice-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 10px;
            background: var(--primary);
            color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: transform 0.2s;
            box-shadow: 0 4px 0 #1b5e20;
        }
        .choice-btn:active { transform: translateY(4px); box-shadow: none; }

        /* ç²å¾—ç‰©å“ç‰¹æ•ˆ */
        .item-popup {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255,255,255,0.95);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 0 50px rgba(255,193,7,0.5);
            z-index: 100;
            display: none;
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 4px solid #ffca28;
        }
        .item-popup h2 { margin: 0; color: #ff6f00; }
        .item-popup .icon { font-size: 5rem; display: block; margin: 10px 0; animation: bounce 1s infinite; }

        /* å‹•ç•« Keyframes */
        @keyframes slideDown { from { top: -200px; opacity: 0; } to { top: 15%; opacity: 1; } }
        @keyframes popIn { from { transform: translate(-50%, -50%) scale(0.5); opacity: 0; } to { transform: translate(-50%, -50%) scale(1); opacity: 1; } }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        /* éŒ¯èª¤/è¨‚æ­£è¦–çª— */
        .feedback-modal {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.85);
            z-index: 99;
            display: none;
            justify-content: center;
            align-items: center;
        }
        .feedback-box {
            background: white;
            width: 85%;
            max-width: 450px;
            padding: 25px;
            border-radius: 15px;
            text-align: left;
            position: relative;
            border-left: 8px solid #f44336;
        }

        /* çµæŸç•«é¢ */
        #end-screen {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: var(--bg-color);
            text-align: center;
            z-index: 200;
            position: fixed;
            top: 0; width: 100%;
        }
        
        .start-btn {
            background: var(--accent);
            color: white;
            padding: 15px 40px;
            font-size: 1.5rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(255, 111, 0, 0.4);
            animation: bounce 2s infinite;
        }

    </style>
</head>
<body>

    <div id="start-screen" style="position:fixed; top:0; left:0; width:100%; height:100%; background:var(--bg-color); z-index:200; display:flex; flex-direction:column; align-items:center; justify-content:center;">
        <div style="font-size: 5rem;">ğŸ•ï¸</div>
        <h1>éœ²ç‡Ÿé‡å¤–å®šå‘</h1>
        <p>æ”¶é›† 5 ä»¶è£å‚™ï¼Œæº–å‚™å»éœ²ç‡Ÿï¼</p>
        <button class="start-btn" onclick="startGame()">é–‹å§‹å†’éšª</button>
    </div>

    <div id="game-wrapper" style="display:none;">
        <header>
            <div style="font-weight:bold; color:var(--primary);">ğŸŒ² å®šå‘è¶Šé‡</div>
            <div class="inventory-box" id="inventory">
                <div class="inv-slot" id="slot-0">?</div>
                <div class="inv-slot" id="slot-1">?</div>
                <div class="inv-slot" id="slot-2">?</div>
                <div class="inv-slot" id="slot-3">?</div>
                <div class="inv-slot" id="slot-4">?</div>
            </div>
        </header>

        <div class="road-scene">
            <div class="road"></div>
            <div id="player">ğŸƒ</div>
        </div>

        <div class="question-panel" id="question-panel">
            <div id="q-text" class="q-text">é¡Œç›®è¼‰å…¥ä¸­...</div>
            <div class="btn-container">
                <button class="choice-btn" id="btn-left" onclick="answer(0)">å·¦é‚Š</button>
                <button class="choice-btn" id="btn-right" onclick="answer(1)">å³é‚Š</button>
            </div>
        </div>
    </div>

    <div id="item-popup" class="item-popup">
        <h2 id="praise-text">å¥½æ£’ï¼</h2>
        <span class="icon" id="earned-icon">ğŸ”¦</span>
        <p>ç²å¾—ï¼š<span id="earned-name" style="font-weight:bold;">æ‰‹é›»ç­’</span></p>
        <p style="color:#777; font-size:0.9rem;">éœ²ç‡Ÿè£å‚™ +1</p>
        <button class="choice-btn" style="background:var(--accent);" onclick="closePopupAndMove()">æ”¾å…¥èƒŒåŒ…ï¼Œç¹¼çºŒå‰é€²</button>
    </div>

    <div id="feedback-modal" class="feedback-modal">
        <div class="feedback-box">
            <h2 style="margin-top:0; color:#c62828;">âŒ èµ°éŒ¯è·¯äº†ï¼</h2>
            <div id="explanation-text" style="background:#ffebee; padding:10px; border-radius:5px; margin-bottom:15px; white-space: pre-wrap;"></div>
            <button class="choice-btn" style="width:100%;" onclick="retryQuestion()">é‡æ–°å°‹æ‰¾æ–¹å‘</button>
        </div>
    </div>

    <div id="end-screen">
        <div style="font-size: 5rem;">â›ºğŸ”¥</div>
        <h1>æŠµé”ç‡Ÿåœ°ï¼</h1>
        <p>ä½ çš„è£å‚™é½Šå…¨ï¼Œå¯ä»¥é–‹å§‹ç”Ÿç«é‡ç‚Šäº†ï¼</p>
        <div style="display:flex; gap:10px; font-size:2rem; margin: 20px;">
            <span>ğŸ—ºï¸</span><span>ğŸ”¦</span><span>ğŸ¥˜</span><span>ğŸ”¥</span><span>â›º</span>
        </div>
        <p>ä½ æ˜¯æœ€æ£’çš„æ¯”ä¾‹å°ºå°ˆå®¶ï¼</p>
        <button class="start-btn" onclick="location.reload()">å†ç©ä¸€æ¬¡</button>
    </div>

    <script>
        // éŠæˆ²æ•¸æ“š
        const items = [
            { icon: 'ğŸ—ºï¸', name: 'åœ°åœ–' },
            { icon: 'ğŸ”¦', name: 'æ‰‹é›»ç­’' },
            { icon: 'ğŸ¥˜', name: 'é‡ç‚Šé‹å…·' },
            { icon: 'ğŸ”¥', name: 'ç‡Ÿç«æœ¨æ' },
            { icon: 'â›º', name: 'è±ªè¯å¸³ç¯·' }
        ];

        const praises = [
            "å¤ªå²å®³äº†ï¼æ–¹å‘æ„Ÿçµ•ä½³ï¼",
            "ç­”å°äº†ï¼ä½ æ˜¯åœ°åœ–å¤§å¸«ï¼",
            "å¤ªç¥äº†ï¼è·é›¢è¨ˆç®—å®Œå…¨æ­£ç¢ºï¼",
            "å¥½æ£’ï¼éœ²ç‡Ÿé”äººå°±æ˜¯ä½ ï¼",
            "æ­£ç¢ºç„¡èª¤ï¼ç¹¼çºŒä¿æŒï¼"
        ];

        let currentLevel = 0;
        let currentQuestion = null;

        // å•Ÿå‹•éŠæˆ²
        function startGame() {
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('game-wrapper').style.display = 'flex';
            playWalkAnimation();
        }

        // æ’­æ”¾èµ°è·¯å‹•ç•«
        function playWalkAnimation() {
            const player = document.getElementById('player');
            const panel = document.getElementById('question-panel');
            
            // éš±è—é¡Œç›®
            panel.style.display = 'none';
            
            // é‡ç½®å‹•ç•«
            player.classList.remove('walking-up');
            void player.offsetWidth; // è§¸ç™¼ Reflow
            player.style.bottom = "-100px"; // ç¢ºä¿èµ·å§‹ä½ç½®

            // é–‹å§‹èµ°è·¯
            player.classList.add('walking-up');

            // èµ°åˆ°å®šä½å¾Œé¡¯ç¤ºé¡Œç›®
            setTimeout(() => {
                generateNewQuestion();
                panel.style.display = 'block';
            }, 1500);
        }

        // é¡Œç›®ç”Ÿæˆé‚è¼¯ (èˆ‡ä¹‹å‰ç›¸åŒï¼Œä½†é‡å°æ–°UIèª¿æ•´)
        function generateNewQuestion() {
            // ç°¡æ˜“çš„äº‚æ•¸ç”Ÿæˆ
            const r = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
            
            const types = ['calc_actual', 'calc_scale', 'map_read'];
            const type = types[r(0, 2)];
            let q, ans, wrong, exp;

            if (type === 'calc_actual') {
                const scale = [1000, 2500, 50000][r(0, 2)];
                const cm = r(2, 8);
                const actualCm = cm * scale;
                const m = actualCm / 100;
                
                q = `åœ°åœ–æ¯”ä¾‹å°º 1:${scale}ã€‚<br>é‡å¾—è·é›¢ ${cm}cmã€‚<br>å¯¦éš›è·é›¢æ˜¯å¤šå°‘ï¼Ÿ`;
                ans = `${m} ç±³`;
                wrong = `${m * 10} ç±³`;
                exp = `æ¯”ä¾‹å°º 1:${scale} ä»£è¡¨åœ–ä¸Š1cm = å¯¦éš›${scale}cmã€‚\nè¨ˆç®—ï¼š${cm} Ã— ${scale} = ${actualCm}cmã€‚\næ›ç®—æˆç±³ï¼š${actualCm} Ã· 100 = ${m}ç±³ã€‚`;
            } else if (type === 'calc_scale') {
                const realM = r(10, 50) * 10; // 100m to 500m
                const mapCm = r(2, 5);
                const realCm = realM * 100;
                const scaleVal = realCm / mapCm;
                
                q = `å¯¦éš›è·é›¢ ${realM}ç±³ã€‚<br>åœ°åœ–ä¸Šç•«äº† ${mapCm}cmã€‚<br>æ¯”ä¾‹å°ºæ˜¯å¤šå°‘ï¼Ÿ`;
                ans = `1 : ${scaleVal}`;
                wrong = `1 : ${scaleVal/10}`;
                exp = `å…ˆæŠŠå–®ä½çµ±ä¸€æˆcmï¼š${realM}ç±³ = ${realCm}cmã€‚\næ¯”ä¾‹ = åœ–ä¸Š : å¯¦éš› = ${mapCm} : ${realCm}ã€‚\nåŒ–ç°¡å¾Œç‚º 1 : ${scaleVal}ã€‚`;
            } else {
                const val = r(1, 5) * 100;
                q = `ç·šæ®µæ¯”ä¾‹å°ºæ¨™ç¤º 0 åˆ° 1cm ä»£è¡¨ ${val}ç±³ã€‚<br>æ›æˆæ•¸å­—æ¯”ä¾‹å°ºæ˜¯å¤šå°‘ï¼Ÿ`;
                ans = `1 : ${val}00`;
                wrong = `1 : ${val}`;
                exp = `åœ–ä¸Š1cmä»£è¡¨${val}ç±³ã€‚\n${val}ç±³ = ${val}00cmã€‚\næ‰€ä»¥æ¯”ä¾‹å°ºæ˜¯ 1 : ${val}00ã€‚`;
            }

            // éš¨æ©Ÿåˆ†é…å·¦å³
            const isLeft = Math.random() < 0.5;
            
            currentQuestion = {
                text: q,
                left: isLeft ? ans : wrong,
                right: isLeft ? wrong : ans,
                correctIdx: isLeft ? 0 : 1,
                explanation: exp
            };

            document.getElementById('q-text').innerHTML = currentQuestion.text;
            document.getElementById('btn-left').innerText = currentQuestion.left;
            document.getElementById('btn-right').innerText = currentQuestion.right;
        }

        // è™•ç†å›ç­”
        function answer(side) {
            if (side === currentQuestion.correctIdx) {
                // ç­”å°
                showReward();
            } else {
                // ç­”éŒ¯
                document.getElementById('explanation-text').innerText = currentQuestion.explanation;
                document.getElementById('feedback-modal').style.display = 'flex';
            }
        }

        // é¡¯ç¤ºçå‹µ
        function showReward() {
            // éš¨æ©Ÿè®šç¾
            const praise = praises[Math.floor(Math.random() * praises.length)];
            document.getElementById('praise-text').innerText = praise;

            // å–å¾—ç•¶å‰çå‹µ
            const item = items[currentLevel];
            document.getElementById('earned-icon').innerText = item.icon;
            document.getElementById('earned-name').innerText = item.name;

            // æ›´æ–° UI èƒŒåŒ…
            const slot = document.getElementById(`slot-${currentLevel}`);
            slot.innerText = item.icon;
            slot.classList.add('earned');

            // é¡¯ç¤ºå½ˆçª—
            document.getElementById('item-popup').style.display = 'block';
            document.getElementById('question-panel').style.display = 'none';
        }

        // é—œé–‰çå‹µä¸¦ç§»å‹•
        function closePopupAndMove() {
            document.getElementById('item-popup').style.display = 'none';
            currentLevel++;

            if (currentLevel >= 5) {
                // éŠæˆ²çµæŸ
                document.getElementById('game-wrapper').style.display = 'none';
                document.getElementById('end-screen').style.display = 'flex';
            } else {
                // ä¸‹ä¸€é—œ
                playWalkAnimation();
            }
        }

        // é‡è©¦
        function retryQuestion() {
            document.getElementById('feedback-modal').style.display = 'none';
            // ä¸é‡ç½®é¡Œç›®ï¼Œè®“å­¸ç”Ÿå†é¸ä¸€æ¬¡æˆ–çœ‹æ‡‚è¨‚æ­£
        }

    </script>
</body>
</html>